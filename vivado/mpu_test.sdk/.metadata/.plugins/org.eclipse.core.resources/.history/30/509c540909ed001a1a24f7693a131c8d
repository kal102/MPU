/*
 * main.c
 *
 *  Created on: 28.08.2020
 *      Author: Kacper
 */


#include "xparameters.h"
#include "xgpio.h"
#include "math.h"
#include "km_gpio.h"
#include "km_axis.h"

/***************************** Main function *********************************/

int main()
{
	XGpio ledGpio;

    volatile int outbuffer[9];

	/* Init GPIO leds */
	if(init(&ledGpio)) {
		goto FAILURE;
	}

// Matrix multiplication test
    /* Send matrix A over AXI stream */
	outbuffer[0] = 36;
	outbuffer[1] = -127;
	outbuffer[2] = 9;
	Load(BUFFER_A, 0, 0, 1, 3, outbuffer);
	setLed(&ledGpio, 0);// set LD0
	/* Send matrix B over AXI stream */
	outbuffer[0] = 99;
	outbuffer[1] = 101;
	outbuffer[2] = 13;
	outbuffer[3] = 13;
	outbuffer[4] = 18;
	outbuffer[5] = 118;
	outbuffer[6] = -115;
	outbuffer[7] = 1;
	outbuffer[8] = 61;
	Load(BUFFER_B, 0, 2, 3, 3, outbuffer);
	setLed(&ledGpio, 1);// set LD1
	/* Send multiply command through AXI stream */
	Multiply(0, 2, -4);
	setLed(&ledGpio, 2);// set LD2
	/* Load result matrix from AXI stream and compare it with expected data*/
	outbuffer[0] = -9150;
	outbuffer[1] = -760;
	outbuffer[2] = -3722;
	if(!CompareResults(1, 3, outbuffer)){
		setLed(&ledGpio, 3);// set LD3
	}
	else{
		setLed(&ledGpio, 4);// set LD4
	}
	/* Failure or end trap */
	FAILURE:
	while(1);
}
